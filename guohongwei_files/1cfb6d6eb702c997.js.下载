
            var rec_url = 'https://www.douban.com/share/recommend?';
        ;
                function exp_dialog(e){var t=document.documentElement;return 0-parseInt(e.offsetHeight/2)+(TBWindowMargin=t&&t.scrollTop||document.body.scrollTop)+"px"}function exp_overlay(e){return 0-parseInt(e.offsetHeight/2)+(TBWindowMargin=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop)+"px"}!function(e,t,n){if("undefined"==typeof DoubanShare){var o={},r=[],a="//img3.doubanio.com/pics/loading.gif",d=".lnk-douban-sharing",l='<div style="padding:30px 0;text-align:center;font-size:14px;color:#060;">分享成功!</div>',c='<div class="rectitle"><span class="gact rr"><a href="#" class="lnk-close">x</a></span><span class="m" >{TITLE}</span></div><div class="bd" style="position:relative;line-height:0;font-size:0;"></div>',u=function(e,t,i){var n;return/device-mobile/i.test(document.documentElement.className)&&(i=.9*document.documentElement.clientWidth),"undefined"!=typeof dui&&dui.Dialog?(n=dui.Dialog({width:i||500,content:e,title:t,isHideClose:0},!0).open(),n.node.addClass("dui-dialog-rec").find(".bd").css({position:"relative",padding:"10px 0 0 0","line-height":0,"font-size":0})):(n=$("#dialog"),0===n.length&&($('<div id="overlay"></div><div id="dialog" class="dialog-shuo"  style="width:'+(i||500)+'px;"></div>').appendTo("body"),n=$("#dialog")),n.html(e),s(),n.find(".lnk-close").click(function(e){e.preventDefault(),f()})),n},s=function(){if("undefined"!=typeof dui&&dui.Dialog&&o.currentDialog)return void o.currentDialog.update();var e=$.browser.msie?-2:16,i=$("#dialog")[0],n=i.offsetWidth,r=(t.body.offsetWidth-n)/2;$("#overlay").css({height:i.offsetHeight+e,width:n+16,left:r+5+"px"}),i.style.left=r+"px"},f=function(){return"undefined"!=typeof dui&&dui.Dialog&&o.currentDialog?(o.currentDialog.close(),void m.fire()):($("#overlay, #dialog").remove(),void m.fire())},g=function(){return r.push(1),"db-sharing-iframe"+r.length},p=function(){var e=t.createElement("iframe");return e.setAttribute("scrolling","no"),e.setAttribute("frameBorder","0"),e.setAttribute("width","100%"),e.setAttribute("allowTransparency","true"),e.src="",e},h=function(e){var t=p(),i=g()+ +new Date+(0|1e6*Math.random()),r=(e.css||"",e.text||"",e.heading||"推荐到豆瓣"),d=e.image?280:230,l=u(c.replace("{TITLE}",r),r,e.width);o.currentDialog=l,$(t).load(function(){try{t.setAttribute("height",t.contentWindow.document.body.clientHeight),s()}catch(e){}}),t.setAttribute("id",i),t.setAttribute("height",e.height||d),t.src=n+$.param(e)+"&alt=xd&callback=DoubanShare.callback&_stamp="+i,l.node?l.node.find(".bd").css("background","url("+a+") 48% 48% no-repeat").eq(0).html("").append(t):l.find(".bd").css("background","url("+a+") 48% 48% no-repeat").html("").append(t),s()},m=function(e){m.callback.push(e)},b=function(e){h(e)},v=function(){$("html").delegate(d,"click",function(e){var t=$(e.currentTarget),n=t.data(),o=["user_id","object_kind","object_id"];e.preventDefault();for(i in n)"number"==typeof n[i]&&(n[i]=t.attr("data-"+i));reportDa={from:"snsrec2share"};for(i in o){var r=o[i];reportDa[r]=n[r]||0}moreurl&&moreurl(e.currentTarget,reportDa),h(n)})};m.callback=[],m.fire=function(){for(;m.callback.length;)m.callback.pop()()},v(),o.cacheUrl={},o.updateDialog=function(e){var t=o.currentDialog;return t.node?(t.node.find("iframe").css("height",e+"px"),void t.update()):(e&&$("#dialog iframe").css("height",e+"px"),void s())},o.closeDialog=function(){var e=o.currentDialog;e.node?(e.node.find(".hd").hide(),e.node.find(".bd").css("background","none").html(l)):(e.find(".rectitle").hide(),e.find(".bd").css("background","none").html(l)),s(),setTimeout(function(){f()},1e3)},o.share=b,o.onDialogClose=m,e.DoubanShare=o,(new Image).src=a}}(window,document,rec_url);
            ;
            Douban.init_on_blacklist = function(node) {
                $(node).click(function(e) {
                    e.preventDefault()
                    alert('你已被对方加入黑名单，不能推荐该日记')
                })
            };
        ;
    function deferred(){var e={done:[],fail:[]},t={done:function(o){return e.done.push(o),t},fail:function(o){return e.fail.push(o),t}};return{resolve:function(){for(var t,o=0;t=e.done[o++];)t.apply(this,arguments)},reject:function(){for(var t,o=0;t=e.fail[o++];)t.apply(this,arguments)},promise:t}}var loader=function(e,t,o,r,n,a){if(e){"function"==typeof t&&(r=t,t=""),"function"==typeof o&&(r=o,o="");var i=function(){loader.loaded[e]=1,r&&r(e),r=null,clearTimeout(d)};if(loader.loaded[e])return loader.loading[e]&&(loader.loading[e]=0),void setTimeout(function(){i()},0);if(loader.loading[e])return void setTimeout(function(){loader(e,t,o,r,n,a)},10);loader.loading[e]=1;var l,d=setTimeout(function(){try{a(e)}catch(e){}},n||6e3),s=t||e.toLowerCase().split(/\./).pop().replace(/[\?#].*/,"");"js"===s?(l=document.createElement("script"),l.setAttribute("type","text/javascript"),l.setAttribute("src",e),l.setAttribute("async",!0)):"css"===s&&(l=document.createElement("link"),l.setAttribute("type","text/css"),l.setAttribute("rel","stylesheet"),l.setAttribute("href",e)),o&&(l.charset=o),"css"===s?setTimeout(function(){i()},0):(l.onerror=function(){i(),l.onerror=null},l.onload=l.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(setTimeout(function(){i()},0),l.onload=l.onreadystatechange=null)});var c=function(){var e=document.getElementsByTagName("script");return e[e.length-1]}();c.parentNode.insertBefore(l,c)}};loader.loaded=window.__external_files_loaded=window.__external_files_loaded||{},loader.loading=window.__external_files_loading=window.__external_files_loading||{},loader.batch=function(){if(0!=arguments.length){var e=Array.prototype.slice.call(arguments);"[object Array]"==Object.prototype.toString.call(e[0])&&(e=e[0]);for(var t,o=deferred(),r=[],n=function(){r.pop(),0===r.length&&o.resolve()},a=0;t=e[a++];)r.push(t),loader(t,n);return o.promise}};

    Do(function() {
      loader.batch([
        'https://img3.doubanio.com/f/shire/8377b9498330a2e6f056d863987cc7a37eb4d486/css/ui/dialog.css',
        'https://img3.doubanio.com/f/shire/4ea3216519a6183c7bcd4f7d1a6d4fd57ce1a244/js/ui/dialog.js'
      ]).done(function() {
        function deferred(){var e={done:[],fail:[]},t={done:function(i){return e.done.push(i),t},fail:function(i){return e.fail.push(i),t}};return{resolve:function(){for(var t,i=0;t=e.done[i++];)t.apply(this,arguments)},reject:function(){for(var t,i=0;t=e.fail[i++];)t.apply(this,arguments)},promise:t}}function asyncRequest(e,t,i){var n=deferred(),l=null,d=(i||"get").toLowerCase();return l=$.ajax({url:e,type:d,dataType:"json",data:"post"===d?$.extend(t,{ck:get_cookie("ck")}):t,error:function(e){n.reject(e)},success:function(e){n.resolve(e)}}),n.promise.abort=function(){l&&l.abort()},n.promise}function doulistCustomeEvents(e){var t=e.node.find(".bn-cancel");e.node.bind("dialog-error",function(i,n){e.setContent('<div class="doulist-submit-success"><p>'+n+'</p>         <div class="item-submit">           <span class="bn-flat"><input type="button" value="关闭" class="bn-cancel"></span>         </div>       </div>      ').update(),t.click(function(){e.close()}),setTimeout(function(){e.close()},3e3)}),e.node.bind("dialog-success",function(i,n){e.setTitle("添加成功").setContent('<div class="doulist-submit-success">         <i></i>已经添加到<a href="'+n.url+'" target="_blank">'+n.name+'</a>         <div>           <p>窗口将在<b class="num">3</b>秒后关闭</p>           <span class="bn-flat"><input type="button" value="关闭" class="bn-cancel"></span>         </div>       </div>      '),t=e.node.find(".bn-cancel"),t.click(function(){e.close(),d&&clearTimeout(d)});var l,d,a=e.node.find(".num"),o=a.text();!function(){l=l||arguments.callee,d=setTimeout(function(){a.text(--o),o?l():e.close()},1e3)}()})}var encodeHTML=function(e){return e.replace(/\&/g,"&amp;").replace(/\"/g,"&quot;").replace(/\'/g,"&apos;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;")},DOULIST_ADDITEM="/j/doulist/{doulist_id}/additem",DOULIST_EDITITEM="/j/doulist/{doulist_id}/edititem",DOULIST_COMMENT="/j/doulist/{doulist_id}/poke",DOULIST_CREATE="/j/doulist/add",DOULIST_LIST="/j/doulist/cat",DOULIST_SEARCH="/j/doulist/search",DOULIST_SEARCH_SELF="/j/doulist/search_user_doulists",DOULIST_GET_ITEM_INFO="/j/doulist/get_item_info",validateForm=function(e,t){var i,n=!0;for(var l in t)t.hasOwnProperty(l)&&(i=e.find(l),n=t[l](i),n&&validateForm.cleanError(i));return n};validateForm.displayError=function(e,t){if(e){var i=e.closest(".item"),n=i.find(".form-field-error");0===n.length&&(n=$('<div class="form-field-error"></div>').prependTo(i)),n.show().html(t)}},validateForm.cleanError=function(e){e.closest(".item").find(".form-field-error").hide()};var doulistDialogForm="undefined"==typeof doulistDialogForm?{}:doulistDialogForm;!function(){function e(e,t,i){var n=t.find("input[name=dl_id]:checked"),l=n.val(),d=n.next().find("b").text(),a={".dl_exist_select input:checked":function(e){return!!e.length||(validateForm.displayError($(".dl_exist_select"),"请选择一个豆列"),!1)}};return validateForm(t,a)&&asyncRequest(DOULIST_ADDITEM.replace("{doulist_id}",l),{sid:i.subjectId,skind:i.subjectKind,surl:i.subjectUrl,comment:i.comment,sync_to_mb:i.sync},"post").done(function(e){return e.r?void t.trigger("form-submit-error",e.err):(e.sid=i.subjectId,e.doulist_id=l,e.name=$.trim(encodeHTML(d)),void t.trigger("form-submit-success",e))}),t}var t=function(t){var i=t.node.find("form");i.submit(function(n){n.preventDefault();var l={subjectId:i.find("input[name=subject_id]").val(),subjectKind:i.find("input[name=subject_kind]").val(),subjectUrl:i.find("input[name=subject_url]").val(),comment:i.find('textarea[name="comment"]').val(),sync:i.find("#dlg-opt-share").attr("checked")?"1":""};e(t,i,l).bind("form-submit-error",function(e,i){t.node.trigger("dialog-error",i)}).bind("form-submit-success",function(e,i){t.node.trigger("dialog-success",i)})}),i.bind("form-submit-fail",function(e,t){validateForm.displayError(i.find("input[name=dl_title]"),t)}),doulistCustomeEvents(t)};doulistDialogForm.initForm=t}(),function(e){function t(e,t){i(t),e.trigger("dialog:show",s),n(t,e),doulistDialogForm.initForm(s)}function i(e){s&&s.close(),e.picture=e.picture||"/pics/doulist_article.png";var t=s=dui.Dialog({title:"添加到豆列",width:640,cls:"dialog-doulist",content:("False"===e.canview?'<div class="doulist-ft" style="text-align:left;">啊，该内容你没有权限查看或已被作者删除。</div>':'<form action="" method="post">        <div class="doulist-bd">          <div class="doulist-preview">            <div><img src="{{picture}}" /></div>            <p class="item-title">{{title}}</p>          </div>          <div class="doulist-content">            <div class="item">              <div class="item-hd">                <input type="text" name="search" class="dl_search" autocomplete="off" placeholder="请输入豆列名称" maxlength="40" />                <a href="javascript: void 0;" class="clear_search">×</a>                <h3>选择豆列</h3>                <input type="button" name="dl_choose" id="dl_new" autocomplete="off" class="lnk-flat" value="创建豆列" />              </div>              <div class="dl-bd">                <div class="dl-item">                  <div class="dl_new_title" style="display: none;"><input id="dl_title" type="text" class="basic-input dl-title" placeholder="输入新豆列名称" maxlength="40" />                   <input type="button" class="lnk-flat dl_new_submit" disabled value="创建" />                  </div>                </div>                <div class="dl-loading">                  加载中...                </div>              </div>            </div>            <div class="item">              <div class="item-hd">                <h3>推荐语<span>（选填）</span></h3>              </div>              <textarea id="doulist_item_comment" class="basic-textarea" name="comment" placeholder="告诉大家你添加它的理由吧"></textarea>            </div>            <input type="hidden" name="dl_cat" value="{{cate}}">            <input type="hidden" name="subject_id" value="{{id}}">            <input type="hidden" name="subject_kind" value="{{cate}}">            <input type="hidden" name="subject_url" value="{{url}}">            </div>          </div>          <div class="doulist-ft">            <a target="_blank" href="https://www.douban.com/service/bookmarklet" class="lnk-bookmarklet">小工具：从浏览器直接把网页内容加入豆列</a>            <span class="bn-flat cancel_btn"><input type="button" class="j_close_dialog" value="取消"></span>            <span class="bn-flat"><input type="submit" class="doulist_submit" value="保存"></span>          </div>      </form>      ').replace(/{{[^{}]+}}/g,function(t){return encodeHTML(e[t.replace(/[{}]/g,"")])})},!0).open();t.update(),t.node.bind("dialog:close",function(){t.node.remove()}),t.node.bind("dialog:change",function(){t.update()})}function n(t,i){var n=s;asyncRequest(DOULIST_LIST).done(function(i){var o='<div><input type="radio" value="{{id}}" id="{{id}}" name="dl_id"><label for="{{id}}"><span>{{count}}</span><b>{{name}}</b></label></div>',s='<div class="dl_exist_select">';e(i.doulist).each(function(e,t){s+=o.replace(/{{[^{}]+}}/g,function(e){return encodeHTML(t[e.replace(/[{}]/g,"")])})}),s+="</div>",e("<div />",{class:"dl-item dl-item-exist"}).insertAfter(e(".dl-item")).html(s),e(".dl-item-exist :radio").eq(0).attr("checked",!0),e(".dl_new_title").hide(),n.node.find("form #doulist_item_comment").val(i.comment),l(t),d(),a()}).fail(function(){e(".dl-loading").text("+_+ 加载失败，请刷新重试")})}function l(t){var i=s,n=e("#dl_new"),l=e(".dl_new_title"),d=e("#dl_title"),a=e(".dl_exist_select");e("#dl_id");n.click(function(){var t=e(".form-field-error");l.is(":hidden")?(t.show()&&n.val("取消创建"),l.slideDown(function(){a.addClass("fold"),d.focus()})):t.hide()&&l.hide()&&n.val("创建豆列")&&a.removeClass("fold")}),i.node.delegate(":radio","change",function(){var n=e(this).val(),l=DOULIST_COMMENT.replace("{doulist_id}",n);e(this).parent().siblings(".checked_dl").removeClass("checked_dl"),e(this).parent().addClass("checked_dl"),asyncRequest(l,{sid:t.id,skind:t.cate}).done(function(e){i.node.find("form #doulist_item_comment").val(e.comment)}).fail(function(){})}),a.bind("DOMMouseScroll mousewheel wheel",function(t){var i=null;"mousewheel"==t.type?i=t.originalEvent.wheelDelta*-1:"wheel"==t.type?i=t.originalEvent.deltaY:"DOMMouseScroll"==t.type&&(i=40*t.originalEvent.detail),i&&(t.preventDefault(),e(this).scrollTop(i+e(this).scrollTop()))})}function d(){var t=s,i=e(".dl_new_title"),n=e("#dl_title"),l=e(".dl_new_submit");n.bind("keyup change",function(){e.trim(n.val()).length?l.removeAttr("disabled"):l.attr("disabled",!0)}),n.bind("keydown",function(e){if(13===e.keyCode)return o(t,i),!1}),l.click(function(){o(t,i)})}function a(){function t(){e(".no-match-warning").length?e(".no-match-warning").show():n.before('<p class="no-match-warning">没有找到匹配豆列，可以换个关键词试试</p>')}var i=e(".dl_search"),n=e(".dl_exist_select"),l=e(".dl_new_title"),d=e("#dl_new"),a=e(".clear_search"),o=null,s="";a.click(function(){return i.val("").change(),!1}),i.focus(function(){if(e(this).addClass("expand"),!l.is(":hidden")){var t=e(".form-field-error");t.hide()&&l.hide()&&d.val("创建豆列")&&n.removeClass("fold")}}),i.bind("keyup change",function(){var l=e.trim(i.val());l.length&&s!==l?(e(".no-match-warning").hide(),o&&o.abort(),a.hide(),i.addClass("loading"),s=l,o=asyncRequest(DOULIST_SEARCH_SELF,{q:l}),o.done(function(l){if(i.removeClass("loading"),a.show(),l&&l.doulists){n.children().hide();for(var d=0;d<l.doulists.length;d++)e("#"+l.doulists[d].id).parent().show();l.doulists.length||t()}}).fail(function(){t(),i.removeClass("loading"),a.show()})):0===l.length&&(e(".no-match-warning").hide(),n.children().show(),a.hide())}),i.bind("keydown",function(t){if(13===t.keyCode)return e(".dl-item-exist label:visible").eq(0).prev().attr("checked",!0),!1})}function o(t,i){var n='<div><input type="radio" value="{{id}}" id="{{id}}" name="dl_id" checked="checked"><label for="{{id}}"><b>{{name}}</b></label></div>',l=e("#dl_title"),d=e("#dl_new"),a=e(".dl_exist_select"),o={"#dl_title":function(e){return""!==e.val()||(validateForm.displayError(e,"请给你的列表起一个名称"),!1)}};if(validateForm(i,o)){var s=e(".dl_new_submit");s.attr("disabled",!0),asyncRequest(DOULIST_CREATE,{title:e("#dl_title").val()},"post").done(function(t){if(t.r)return void alert(t.err);t.doulist_id=t.id;var i=n.replace(/{{[^{}]+}}/g,function(e){return encodeHTML(t[e.replace(/[{}]/g,"")])}),o=e(i);o.prependTo(a),o.siblings().removeClass("checked_dl"),o.addClass("checked_dl"),a.animate({scrollTop:0},100),d.click(),l.val("").change()}).fail(function(){alert("网络问题，请稍后重试"),s.removeAttr("disabled")})}else t.update();return i}var s;e.fn.doulistDialog=function(i){return new t(e(this),i)}}(jQuery);

        $(document).delegate('.lnk-doulist-add', 'click', function(e) {
          e.preventDefault();
          var self = $(this);
          var param = $.extend({'url':''}, $(this).data(), {link: this.href});
          // 兼容jquery 1.8.x
          var newParam = {};
          for (key in param) {
            if (typeof param[key] === 'number') {
              param[key] = self.attr('data-'+key);
            }
            if (param.hasOwnProperty(key)) {
              newParam[$.camelCase(key)] = param[key];
            }
          }
          self.doulistDialog(newParam);
        });

      });
    });
  ;
                !function(e,t,i){function r(e,n){this.config=i.extend(!0,{},a,e);var o=r.serializeOpenGraph();this.pageInfo=i.extend({title:o.title||t.title,url:o.url||t.location.href,pic:("array"===i.type(o.image)?o.image[0]:o.image)||"",desc:o.description||"",site:o.site_name||""},n)}var a={weibo:{appkey:""},douban:{},qq:{},qzone:{}};r.serializeOpenGraph=function(){var e={};i('meta[property^="og:"]').each(function(t,r){r=i(r);var a=r.attr("property").replace(/^og\:/,"");e[a]=r.attr("content")});var t=i('meta[property="og:image"]');return t.length>1&&(e.image=t.map(function(e,t){return i(t).attr("content")}).toArray()),e},r.prototype={constructor:r,set:function(e,t){var r={};r[e]=t,i.extend(this.config,r)},get:function(e){var t=i.extend({},this.pageInfo,this.config[e]);return{douban:{url:"https://www.douban.com/share/service/?"+i.param({href:t.url,name:t.title,image:t.pic,text:t.desc})},weibo:{url:"http://v.t.sina.com.cn/share/share.php?"+i.param({appkey:t.appkey,url:t.url,title:t.title,pic:t.pic})},qq:{url:"http://connect.qq.com/widget/shareqq/index.html?"+i.param({url:t.url,desc:t.title,pics:t.pic,site:t.site})},qzone:{url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?"+i.param({url:t.url,title:t.title,summary:t.desc,pics:t.pic})}}[e]},openInNewWindow:function(t,r){r=r||{};var a=r.width||500,n=r.height||360,o=i.extend({},{width:a,height:n,toolbar:0,location:0,resizable:1,scrollbars:"yes",left:r.left||(screen.width-a)/2,top:r.top||(screen.height-n)/2},r);e.open(t,"SocialSharing",i.param(o).replace(/&/g,","))}},window.SocialSharing=r}(window,document,jQuery);

            ;
            $(function(){function a(a,i){a.find(".sharing-wechat-qrcode").html('<img src="//img3.doubanio.com/dae/qrgen/v2/'+encodeURIComponent(i)+'.png" alt="扫描二维码" />')}var i=$(document),e={weibo:"bshare_sina",qq:"bshare_qqim",qzone:"bshare_qzone"},n={qq:{width:800,height:600},qzone:{width:800,height:600}};i.delegate(".sharing-indicator","click",function(){var i=$(this).closest(".sharing"),e=i.find(".sharing-layer");if(e.hasClass("is-hidden")){var n=i.data("target").url;e.removeClass("is-hidden"),a(e,n)}else e.addClass("is-hidden")}),$("body").bind("click",function(a){if(!$(a.target).hasClass("sharing-indicator")){var i=$(".sharing-layer");i.hasClass("is-hidden")||$(a.target).closest(".sharing-layer").length||i.addClass("is-hidden")}}),$(".sharing-layer").bind("click",function(a){return $(a.target).closest(".sharing-list").length?void $(".sharing-layer").addClass("is-hidden"):void a.stopPropagation()}),i.delegate("[data-share]","click",function(){var a=$(this),i=a.data("share"),s=$(this).closest(".sharing"),t=s.data("target")||{},r=new SocialSharing({weibo:{appkey:"3015934887"}},t),d="https://www.douban.com/link2?type=redir&vendor="+e[i]+"&url="+encodeURIComponent(r.get(i).url);r.openInNewWindow(d,n[i])})});
        ;
var dialogJoinGroup = $(".dialog_join_group");
window._JOIN_POPUP_DIALOG = function() {
    dialogJoinGroup.css('display', 'block');
}
$(".join_group_cancel, .join_group_close").bind('click', function(e) {
    dialogJoinGroup.css('display', 'none');
})
